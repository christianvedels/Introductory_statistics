---
output:
  xaringan::moon_reader:
    seal: false
    includes:
      after_body: insert-logo.html
    self_contained: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
editor_options: 
  chunk_output_type: console
---
class: center, inverse, middle

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r xaringan-tile-view, echo=FALSE}
xaringanExtra::use_tile_view()
```

```{r xaringanExtra, echo = FALSE}
xaringanExtra::use_progress_bar(color = "#808080", location = "top")
```

```{css echo=FALSE}
.pull-left {
  float: left;
  width: 44%;
}
.pull-right {
  float: right;
  width: 44%;
}
.pull-right ~ p {
  clear: both;
}


.pull-left-wide {
  float: left;
  width: 66%;
}
.pull-right-wide {
  float: right;
  width: 66%;
}
.pull-right-wide ~ p {
  clear: both;
}

.pull-left-narrow {
  float: left;
  width: 30%;
}
.pull-right-narrow {
  float: right;
  width: 30%;
}

.pull-right-extra-narrow {
  float: right;
  width: 20%;
}

.pull-center {
  margin-left: 28%;
  width: 44%;
}

.pull-center-wide {
  margin-left: 17%;
  width: 66%;
}

.tiny123 {
  font-size: 0.40em;
}

.small123 {
  font-size: 0.80em;
}

.large123 {
  font-size: 2em;
}

.red {
  color: red
}

.orange {
  color: orange
}

.green {
  color: green
}
```



# Statistics  
## Lecture 12: Simple Regression Analysis  

### Christian Vedel,<br>Department of Economics  

### Email: [christian-vs@sam.sdu.dk](christian-vs@sam.sdu.dk)  

### Updated `r Sys.Date()`

.footnote[
.small123[
*Please beware. I work on these slides until the last minute before the lecture and push most changes along the way. Until the actual lecture, this is just a draft*  
]
]

---
class: middle

# Today's Lecture
.pull-left-wide[
**Outline:**
- Simple Regression: Model and Assumptions  
- Statistics of fit ($R^2$ and $adj.\;R^2$)
- Hypothesis testing in regression models
- Prediction versus inference
- Hypothesis testing
]

.pull-right-narrow[
![Trees](Figures/Trees1.jpg)
]

---
class: middle

# Motivating Example: Galton’s Heights

.pull-left-wide[
.small123[
### Background
- Francis Galton (1889): “regression to the mean”  
- Study of father heights \(x\) and son heights \(y\)  
- Observation: Tall fathers tend to have tall sons, but closer to population average  
- This inspired the term “regression analysis”

### Examples
- Galton found that:
  + For every cm of the height of the father, the full grown height of the child increased by 0.38 cm
  + (Dark history of early statisticians not to forget)
- Today regression analysis used to study:
  + Gender wage gap
  + Optimal ways to pick stocks
  + Weather forecast
  + Measuring effects of new medicin

]

]

.pull-right-narrow[
![Galton Scatter](Figures/Galton.png)
.small123[
*Source: Galton (1889), data on father vs. son heights*  
]
]

```{r eval=FALSE, include=FALSE}
library(tidyverse)
library(plotly)

df0 = read_csv("Examples/Galton_data/Galton_Family_Heights.csv")

df0 = df0 %>% 
  mutate_all(function(x){x*2.54}) %>% 
  mutate(gender = ifelse(gender > 0, "male", "female"))

p1 = df0 %>% 
  ggplot(aes(Father_height, Child_height)) + 
  geom_point(alpha = 0.5) + 
  theme_minimal() + 
  labs(
    x = "Father height (cm)",
    y = "Childrens height (cm)"
  ) + 
  geom_smooth(method = "lm")


p2 = df0 %>% 
  ggplot(aes(Father_height, Child_height, col = gender)) + 
  geom_point(alpha = 0.5) + 
  theme_minimal() + 
  labs(
    x = "Father height (cm)",
    y = "Childrens height (cm)"
  ) + 
  geom_smooth(method = "lm")

ggsave("Figures/Galton.png", width = 6, height = 4, plot = p1)
ggsave("Figures/Galton_wide.png", width = 6, height = 3, plot = p1)
ggsave("Figures/Galton_gender.png", width = 6, height = 3, plot = p2)

# Regression models
lm(Child_height ~ Father_height, data = df0) %>% summary()
lm(Child_height ~ Father_height + Mother_height + gender, data = df0) %>% summary()

```

---
class: middle

# The simple idea of regression analysis: Line fitting
.pull-center[
![Galton_wide](Figures/Galton.png)
]

$$\textit{Child height}_i = \beta_0 + \beta_1\textit{Father height}_i + \varepsilon_i$$
$$\textit{Child height}_i = 101.95 + 0.385 \times \textit{Father height}_i + \varepsilon_i$$
(This is a trend line in excel)


---
class: middle
# Next time: Multiple regression

![Gender_Galton](Figures/Galton_gender.png)



---
class: middle, center

# Next time again: Even more multiple regression
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)

df0 = read_csv("Examples/Galton_data/Galton_Family_Heights.csv")

df0 = df0 %>% 
  mutate_all(function(x){x*2.54}) %>% 
  mutate(gender = ifelse(gender > 0, "male", "female"))

# Fit linear models for each gender
lm_model_male <- lm(Child_height ~ Father_height + Mother_height, data = df0 %>% filter(gender == "male"))
lm_model_female <- lm(Child_height ~ Father_height + Mother_height, data = df0 %>% filter(gender == "female"))

# Create a grid of father and mother heights
father_range <- seq(min(df0$Father_height), max(df0$Father_height), length.out = 30)
mother_range <- seq(min(df0$Mother_height), max(df0$Mother_height), length.out = 30)

# Create a data frame for the grid
grid_df <- expand.grid(Father_height = father_range, Mother_height = mother_range)

# Predict child height for each combination of father and mother heights for both genders
grid_df_male <- grid_df %>% mutate(Child_height = predict(lm_model_male, newdata = grid_df))
grid_df_female <- grid_df %>% mutate(Child_height = predict(lm_model_female, newdata = grid_df))

# Reshape the predicted child heights into matrices
z_matrix_male <- matrix(grid_df_male$Child_height, nrow = length(father_range), ncol = length(mother_range))
z_matrix_female <- matrix(grid_df_female$Child_height, nrow = length(father_range), ncol = length(mother_range))

# Create the 3D scatter plot with separate regression surfaces for each gender
p_3d <- df0 %>% 
  plot_ly(x = ~Father_height, y = ~Mother_height, z = ~Child_height, 
          color = ~gender, colors = c("blue", "pink"), 
          type = "scatter3d", mode = "markers") %>%
  add_surface(x = father_range, y = mother_range, z = z_matrix_male, 
              showscale = FALSE, opacity = 0.5, name = "Male Surface") %>%  # Male regression surface
  add_surface(x = father_range, y = mother_range, z = z_matrix_female, 
              showscale = FALSE, opacity = 0.5, name = "Female Surface") %>%  # Female regression surface
  layout(scene = list(
    xaxis = list(title = 'Father Height (cm)'),
    yaxis = list(title = 'Mother Height (cm)'),
    zaxis = list(title = 'Child Height (cm)')
  ))

# Show the interactive plot
p_3d

```

---
class: middle

# Next Time
.pull-left[
- Regression analysis
]

.pull-right-narrow[
![Next Steps](Figures/Trees1.jpg)
]






